<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE en-export SYSTEM "http://xml.evernote.com/pub/evernote-export4.dtd">
<en-export export-date="20240409T043343Z" application="Evernote" version="10.82.2">
  <note>
    <title>Dynamic Multipoint VPN (DMVPN) - Class Notes</title>
    <created>20140929T172146Z</created>
    <updated>20240407T214853Z</updated>
    <note-attributes>
    </note-attributes>
    <content>
      <![CDATA[<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE en-note SYSTEM "http://xml.evernote.com/pub/enml2.dtd"><en-note style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div> - I never typed these up.</div><div> - Added 7 April 2024</div><div><br/></div><div><br/></div><div><b>Dynamic Multipoint VPN (DMVPN</b></div><div> - mGRE</div><div>   -> Multipoint GRE ( Generic Router Encapsulation )</div><div> - HNRP</div><div>   -> Next Hop Resolution Protocol</div><div> - IPSec</div><div>   -> IPSec ( optional )</div><div> - Hub and spoke</div><div><br/></div><div>&lt;insert picture from page 366></div><div><br/></div><div> - NBMA</div><div>   -> Nonbroadcast Multiaccess Network</div><div>     -> IP address on edge interface</div><div> - Tunnel address</div><div>   -> GRE tunnel IP address</div><div><br/></div><div>&lt;insert picture from page 367></div><div><br/></div><div><b>NHRP</b></div><div> - It is used to resolve tunnel IP addresses into NBMA IP addresses</div><div> - All spokes will have IP addresses of the hub mapped statically</div><div> - Hub router will have an NHRP cache of "tunnel to NMBA IP address" mappings for spokes</div><div><br/></div><div><b>DMVPN Phase 1</b></div><div> - Hub</div><div><br/></div><div>R1(config)# <b><span style="--en-highlight:yellow;background-color: #ffef9e;">int tunnel 0</span></b></div><div><b><span style="--en-highlight:yellow;background-color: #ffef9e;">ip add <a href="http://10.0.0.1">10.0.0.1</a> 255.255.255.0</span></b></div><div><b><span style="--en-highlight:yellow;background-color: #ffef9e;">tunnel source <a href="http://180.1.1.1">180.1.1.1</a></span></b></div><div><b><span style="--en-highlight:yellow;background-color: #ffef9e;">tunnel mode gre multipoint</span></b></div><div><b><span style="--en-highlight:yellow;background-color: #ffef9e;">ip nhrp network-id 500</span></b></div><div><b><span style="--en-highlight:yellow;background-color: #ffef9e;">ip nhrp map multicast dynamic</span></b></div><div>  - Needed to allow multicast traffic</div><div><br/></div><div> - Spokes</div><div><br/></div><div>R2(config)# <b><span style="--en-highlight:yellow;background-color: #ffef9e;">int tunnel 0</span></b></div><div><b><span style="--en-highlight:yellow;background-color: #ffef9e;">ip add <a href="http://10.0.0.2">10.0.0.2</a> <a href="http://255.255.255.0">255.255.255.0</a></span></b></div><div><b><span style="--en-highlight:yellow;background-color: #ffef9e;">tunnel source <a href="http://180.2.2.2">180.2.2.2</a></span></b></div><div><b><span style="--en-highlight:yellow;background-color: #ffef9e;">tunnel mode gre multipoint</span></b></div><div><b><span style="--en-highlight:yellow;background-color: #ffef9e;">ip nhrp network-id 500</span></b></div><div><b><span style="--en-highlight:yellow;background-color: #ffef9e;">ip nhrp nhs <a href="http://10.0.0.1">10.0.0.1</a></span></b></div><div> - NHS ( Next Hop Server )</div><div><b><span style="--en-highlight:yellow;background-color: #ffef9e;">ip nhrp map <a href="http://10.0.0.1">10.0.0.1</a> <a href="http://180.1.1.1">180.1.1.1</a></span></b></div><div><b><span style="--en-highlight:yellow;background-color: #ffef9e;">ip nhrp map multicast 180.1.1.1</span></b></div><div><br/></div><div><br/></div><div> - All routers</div><div>   -> Routing</div><div><br/></div><div>R1(config)# <b><span style="--en-highlight:yellow;background-color: #ffef9e;">router eigrp 1</span></b></div><div><b><span style="--en-highlight:yellow;background-color: #ffef9e;">network <a href="http://10.0.0.0">10.0.0.0</a></span></b></div><div><b><span style="--en-highlight:yellow;background-color: #ffef9e;">network <a href="http://180.1.1.0">180.1.1.0</a></span></b></div><div><b><span style="--en-highlight:yellow;background-color: #ffef9e;"><span style="--en-markholder:true;"><br/></span></span></b></div><div>R1(config)# <b><span style="--en-highlight:yellow;background-color: #ffef9e;">int tunnel 0</span></b></div><div><b><span style="--en-highlight:yellow;background-color: #ffef9e;">no ip split-horizon eigrp 1</span></b></div><div><b><span style="--en-highlight:yellow;background-color: #ffef9e;">no ip next-hop-self eigrp 1</span></b></div><div><b><span style="--en-highlight:yellow;background-color: #ffef9e;"><span style="--en-markholder:true;"><br/></span></span></b></div><div><b><span style="--en-highlight:yellow;background-color: #ffef9e;">sh dmvpn</span></b></div><div><br/></div><div><br/></div><div><b>IP Security</b></div><div> -  Main mode</div><div>   -> ISAKMP tunnel</div><div> - Quick mode</div><div>   -> IPSec tunnel</div><div><br/></div><div>&lt;insert picture from page 368></div><div><br/></div><div> - Key exchange occurs within the ISAKMP tunnel</div><div><br/></div><div><br/></div><div><b>Encryption and Authentication</b></div><div> - AH</div><div>   -> Authentication Header</div><div> - ESP</div><div>   -> Encapsulation Security Payload</div><div>     -> Authentication</div><div>       -> MD5</div><div>       -> SHA1</div><div>     -> Encryption</div><div>       -> DES</div><div>       -> 3DES</div><div>       -> AES</div><div><br/></div><div><br/></div><div><b>ISAKMP Parameters</b></div><div> - Encapsulation</div><div> - Pre-shared key</div><div> - Diffie-Hellman Group</div><div><br/></div><div><br/></div><div><b>IPsec Transform Set</b></div><div> - Authentication</div><div> - Encryption</div><div> - Modes</div><div>   -> Tunnel mode</div><div>     -> Entire packet is encrypted</div><div>     -> New IP header created</div><div>   -> Transport mode</div><div>     -> Only IP payload is encrypted</div><div>     -> Source and destination IP address are unencrypted</div><div><br/></div><div><br/></div><div><b>IPSec Profile</b></div><div> - Applied to mGRE tunnel</div><div> - On all routers</div><div><br/></div><div>R1(config)# <b><span style="--en-highlight:yellow;background-color: #ffef9e;">crypto isakmp policy 1</span></b></div><div><b><span style="--en-highlight:yellow;background-color: #ffef9e;">encryption aes</span></b></div><div><b><span style="--en-highlight:yellow;background-color: #ffef9e;">authentication pre-shared</span></b></div><div><b><span style="--en-highlight:yellow;background-color: #ffef9e;">group 14</span></b></div><div><b><span style="--en-highlight:yellow;background-color: #ffef9e;"><span style="--en-markholder:true;"><br/></span></span></b></div><div>R1(config)# <b><span style="--en-highlight:yellow;background-color: #ffef9e;">crypto isakmp key CCIE@123 address <a href="http://10.0.0.0">10.0.0.0</a> <a href="http://255.255.255.0">255.255.255.0</a></span></b></div><div> - Use <a href="http://0.0.0.0">0.0.0.0</a> <a href="http://0.0.0.0">0.0.0.0</a> for dynamic connections</div><div><br/></div><div>R1(config# <b><span style="--en-highlight:yellow;background-color: #ffef9e;">crypto ipsec transform-set FERALPACKET</span></b></div><div><b><span style="--en-highlight:yellow;background-color: #ffef9e;">esp-aes esp-sha-hmac</span></b></div><div><b><span style="--en-highlight:yellow;background-color: #ffef9e;">mode tunnel</span></b></div><div> - or <b><span style="--en-highlight:yellow;background-color: #ffef9e;">mode transport</span></b></div><div><br/></div><div>R1(config)# <span style="--en-highlight:yellow;background-color: #ffef9e;">crypto ipsec profile PROFILE1</span></div><div><span style="--en-highlight:yellow;background-color: #ffef9e;">set transform-set FERALPACKET</span></div><div><b><span style="--en-markholder:true;"><br/></span></b></div><div>R1(config)# <b><span style="--en-highlight:yellow;background-color: #ffef9e;">int tunnel 0</span></b></div><div><b><span style="--en-highlight:yellow;background-color: #ffef9e;">tunnel protection ipsec profile PROFILE1</span></b></div><div><b><span style="--en-highlight:yellow;background-color: #ffef9e;"><span style="--en-markholder:true;"><br/></span></span></b></div><div><b><span style="--en-highlight:yellow;background-color: #ffef9e;">sh crypto isakmp sa</span></b></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></en-note>      ]]>
    </content>
  </note>
</en-export>
